"use strict";(self.webpackChunkaccoutrement=self.webpackChunkaccoutrement||[]).push([[976],{619:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>t,default:()=>h,frontMatter:()=>l,metadata:()=>r,toc:()=>c});var i=s(4848),a=s(8453);const l={sidebar_position:1,slug:"/"},t="Hands-on: Maximo 7.x to MAS Manage Upgrade Lab 1261",r={id:"intro",title:"Hands-on: Maximo 7.x to MAS Manage Upgrade Lab 1261",description:"1 Install Single Node OpenShift via APIs",source:"@site/docs/intro.md",sourceDirName:".",slug:"/",permalink:"/",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1,slug:"/"},sidebar:"tutorialSidebar"},o={},c=[{value:"1 Install Single Node OpenShift via APIs",id:"1-install-single-node-openshift-via-apis",level:2},{value:"1.1 Prepare token and secrets",id:"11-prepare-token-and-secrets",level:3},{value:"1.1.1 API token",id:"111-api-token",level:4},{value:"1.1.2 Software (pull) secret",id:"112-software-pull-secret",level:4},{value:"1.1.3 Secure Shell (SSH) key",id:"113-secure-shell-ssh-key",level:4},{value:"1.1.4 Name your OpenShift",id:"114-name-your-openshift",level:4},{value:"1.1.5 OpenShift version",id:"115-openshift-version",level:4},{value:"1.2 Create the instance",id:"12-create-the-instance",level:3},{value:"1.3 Create VMware Virtual Machine",id:"13-create-vmware-virtual-machine",level:3},{value:"1.3 Install SNO",id:"13-install-sno",level:3},{value:"\u23f0 ~45 minutes",id:"-45-minutes",level:2},{value:"2 OpenShift Day two operations",id:"2-openshift-day-two-operations",level:2},{value:"2.1 OpenShift credentials",id:"21-openshift-credentials",level:3},{value:"2.1.1 Retrieve OpenShift credentials",id:"211-retrieve-openshift-credentials",level:4},{value:"2.1.2 Save credentials.",id:"212-save-credentials",level:4},{value:"2.2 MAS CLI",id:"22-mas-cli",level:3},{value:"2.2.1 Setup MAS CLI",id:"221-setup-mas-cli",level:4},{value:"2.3 Command line login to OpenShift",id:"23-command-line-login-to-openshift",level:3},{value:"2.4 LVM Storage",id:"24-lvm-storage",level:3},{value:"2.5 Registry (LVM)",id:"25-registry-lvm",level:3},{value:"3 Maximo 7.x customization",id:"3-maximo-7x-customization",level:2},{value:"3.1 Instructor-led.",id:"31-instructor-led",level:3},{value:"4 Maximo 7.x database migration",id:"4-maximo-7x-database-migration",level:2},{value:"4.1 Instructor-led.",id:"41-instructor-led",level:3},{value:"5 Maximo Application Suite &amp; Manage",id:"5-maximo-application-suite--manage",level:2}];function d(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"hands-on-maximo-7x-to-mas-manage-upgrade-lab-1261",children:"Hands-on: Maximo 7.x to MAS Manage Upgrade Lab 1261"})}),"\n",(0,i.jsx)(n.h2,{id:"1-install-single-node-openshift-via-apis",children:"1 Install Single Node OpenShift via APIs"}),"\n",(0,i.jsx)(n.h3,{id:"11-prepare-token-and-secrets",children:"1.1 Prepare token and secrets"}),"\n",(0,i.jsx)(n.h4,{id:"111-api-token",children:"1.1.1 API token"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Change directory."}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd 1261\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsx)(n.li,{children:"Refresh provided token."}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"source ./refresh-token\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"3",children:["\n",(0,i.jsx)(n.li,{children:"Verify that you can access the API by running the following command:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'curl -s https://api.openshift.com/api/assisted-install/v2/component-versions \\\n-H "Authorization: Bearer ${API_TOKEN}" \\\n| jq\n'})}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsx)(n.p,{children:"Expected outcome"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "release_tag": "v2.33.1",\n  "versions": {\n    "assisted-installer": "registry.redhat.io/rhai-tech-preview/assisted-installer-rhel8:v1.0.0-353",\n    "assisted-installer-controller": "registry.redhat.io/rhai-tech-preview/assisted-installer-reporter-rhel8:v1.0.0-431",\n    "assisted-installer-service": "quay.io/app-sre/assisted-service:4b0d0eb",\n    "discovery-agent": "registry.redhat.io/rhai-tech-preview/assisted-installer-agent-rhel8:v1.0.0-332"\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h4,{id:"112-software-pull-secret",children:"1.1.2 Software (pull) secret"}),"\n",(0,i.jsxs)(n.ol,{start:"4",children:["\n",(0,i.jsx)(n.li,{children:"Software (pull) secret in JSON format has been made available to you in advance. Save it as a variable."}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"PULL_SECRET=$(cat ./pull-secret-escaped.json)\n"})}),"\n",(0,i.jsx)(n.h4,{id:"113-secure-shell-ssh-key",children:"1.1.3 Secure Shell (SSH) key"}),"\n",(0,i.jsxs)(n.ol,{start:"5",children:["\n",(0,i.jsx)(n.li,{children:"SSH key has been made available to you in advance. Save it as a variable."}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"SSH_KEY=$(cat ~/.ssh/id_ed25519.pub)\n"})}),"\n",(0,i.jsx)(n.h4,{id:"114-name-your-openshift",children:"1.1.4 Name your OpenShift"}),"\n",(0,i.jsxs)(n.ol,{start:"6",children:["\n",(0,i.jsx)(n.li,{children:"Save your assigned name as a variable. Replace XX with your number before executing the command."}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"export NAME=ocpwksXX\n"})}),"\n",(0,i.jsx)(n.h4,{id:"115-openshift-version",children:"1.1.5 OpenShift version"}),"\n",(0,i.jsxs)(n.ol,{start:"7",children:["\n",(0,i.jsx)(n.li,{children:"At the time of this workshop, we are working with version 4.15. Save it as a variable."}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"export VERSION=4.15\n"})}),"\n",(0,i.jsx)(n.h3,{id:"12-create-the-instance",children:"1.2 Create the instance"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Using the above saved values, create your instance."}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'RESPONSE=$(curl -s -X POST "https://api.openshift.com/api/assisted-install/v2/clusters" \\\n-H "Content-Type: application/json" \\\n-H "Authorization: Bearer ${API_TOKEN}" \\\n-d \'{\n  "name": "\'"${NAME}"\'",\n  "high_availability_mode": "None",\n  "openshift_version": "4.15",\n  "base_dns_domain": "gym.lan",\n  "ssh_public_key": "\'"${SSH_KEY}"\'",\n  "pull_secret": "\'"${PULL_SECRET}"\'",\n  "network_type": "OVNKubernetes",\n  "schedulable_masters": true\n}\') ; echo $RESPONSE\n'})}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsx)(n.li,{children:"Identify the clusterID."}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"CLUSTER_ID=$(echo $RESPONSE | jq -r '.cluster_networks[0].cluster_id') ; echo $CLUSTER_ID\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"3",children:["\n",(0,i.jsx)(n.li,{children:"Get Cluster Status"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'STATUS=$(curl -s -X GET "https://api.openshift.com/api/assisted-install/v2/clusters/${CLUSTER_ID}" \\\n  -H "Content-Type: application/json" \\\n  -H "Authorization: Bearer $API_TOKEN") ; echo $STATUS\n'})}),"\n",(0,i.jsxs)(n.ol,{start:"4",children:["\n",(0,i.jsx)(n.li,{children:"Create Infra Env"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'export INFRA_ENV_ID=$(curl -s -X POST "https://api.openshift.com/api/assisted-install/v2/infra-envs" \\\n-H "Content-Type: application/json" \\\n-H "Authorization: Bearer ${API_TOKEN}" \\\n-d \'{\n  "ssh_authorized_key": "\'"${SSH_KEY}"\'",\n  "pull_secret": "\'"${PULL_SECRET}"\'",\n  "name": "\'"${NAME}"\'",\n  "image_type": "full-iso",\n "cluster_id": "\'"${CLUSTER_ID}"\'",\n "openshift_version": "4.15"\n}\') ; echo $INFRA_ENV_ID\n'})}),"\n",(0,i.jsxs)(n.ol,{start:"5",children:["\n",(0,i.jsx)(n.li,{children:"Get ISO URL"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ISO_URL=$(echo $INFRA_ENV_ID | jq -r '.download_url')\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"6",children:["\n",(0,i.jsx)(n.li,{children:"Download ISO"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"wget -O ~/Downloads/${NAME}.iso $ISO_URL\n"})}),"\n",(0,i.jsx)(n.h3,{id:"13-create-vmware-virtual-machine",children:"1.3 Create VMware Virtual Machine"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Create VM."}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"./govc_create_vm.sh\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsx)(n.p,{children:"You must wait few minutes here."})}),"\n",(0,i.jsx)(n.h3,{id:"13-install-sno",children:"1.3 Install SNO"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"After about a few minutes, install OpenShift."}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"source ./refresh-token\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'curl -X POST "https://api.openshift.com/api/assisted-install/v2/clusters/${CLUSTER_ID}/actions/install" \\\n-H "Authorization: Bearer ${API_TOKEN}"\n'})}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsx)(n.li,{children:"Get Status"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'while [ "$STATUS" != "installed" ]; do\n    STATUS=$(curl -s -X GET "https://api.openshift.com/api/assisted-install/v2/clusters/${CLUSTER_ID}" \\\n    -H "Authorization: Bearer ${API_TOKEN}" | jq -r .status)\n    echo "Current Status: $STATUS"\n    if [ "$STATUS" != "installed" ]; then\n        # Wait for a while before checking again\n        sleep 90\n    fi\ndone\n'})}),"\n",(0,i.jsxs)(n.admonition,{type:"note",children:[(0,i.jsx)(n.p,{children:"Expected outcome:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Current Status: preparing-for-installation\nCurrent Status: installing\nCurrent Status: installing\nCurrent Status: finalizing\nCurrent Status: null\n"})}),(0,i.jsxs)(n.p,{children:["The while loop times out when the token expires. Take the following actions when you see the ",(0,i.jsx)(n.code,{children:"null"})," message..."]}),(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Press Ctrl+c to exit the while loop."}),"\n",(0,i.jsxs)(n.li,{children:["Run ",(0,i.jsx)(n.code,{children:"source ./refresh-token"})]}),"\n",(0,i.jsx)(n.li,{children:"Copy/paste the while loop command to start getting the status again."}),"\n"]})]}),"\n",(0,i.jsx)(n.h2,{id:"-45-minutes",children:"\u23f0 ~45 minutes"}),"\n",(0,i.jsxs)(n.admonition,{type:"info",children:[(0,i.jsx)(n.p,{children:"While we wait for the Openshift to finish the installation, we switch gears and work on Maximo customization and Maximo database migration. We will come back to OpenShift after the installation has been completed successfully."}),(0,i.jsx)(n.p,{children:"Jump down below to section number 3."})]}),"\n",(0,i.jsx)(n.h2,{id:"2-openshift-day-two-operations",children:"2 OpenShift Day two operations"}),"\n",(0,i.jsx)(n.h3,{id:"21-openshift-credentials",children:"2.1 OpenShift credentials"}),"\n",(0,i.jsx)(n.h4,{id:"211-retrieve-openshift-credentials",children:"2.1.1 Retrieve OpenShift credentials"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Refresh your API token."}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"source ./refresh-token\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsx)(n.li,{children:"Retrieve credentials."}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'curl -s -X GET "https://api.openshift.com/api/assisted-install/v2/clusters/${CLUSTER_ID}/credentials" -H "Authorization: Bearer ${API_TOKEN}" | jq\n'})}),"\n",(0,i.jsx)(n.h4,{id:"212-save-credentials",children:"2.1.2 Save credentials."}),"\n",(0,i.jsxs)(n.ol,{start:"3",children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Copy/paste the retreived credentials to the passwords.txt file."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Replace xxxx-xxxx with the kubeadmin password."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"22-mas-cli",children:"2.2 MAS CLI"}),"\n",(0,i.jsx)(n.h4,{id:"221-setup-mas-cli",children:"2.2.1 Setup MAS CLI"}),"\n",(0,i.jsxs)(n.ol,{start:"5",children:["\n",(0,i.jsx)(n.li,{children:"Change directory"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd mas9\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"6",children:["\n",(0,i.jsx)(n.li,{children:"Start MAS CLI"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"podman run -it --pull always -v ${PWD}:/mas9:Z --name ibmmas quay.io/ibmmas/cli:10.9.1\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"7",children:["\n",(0,i.jsx)(n.li,{children:"Change directory"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd /mas9\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cp /mascli/ansible-devops/common_vars/default_storage_classes.yml /mascli/ansible-devops/common_vars/default_storage_classes.yml.bak && mv default_storage_classes.yml /mascli/ansible-devops/common_vars/default_storage_classes.yml\n"})}),"\n",(0,i.jsx)(n.h3,{id:"23-command-line-login-to-openshift",children:"2.3 Command line login to OpenShift"}),"\n",(0,i.jsxs)(n.ol,{start:"8",children:["\n",(0,i.jsxs)(n.li,{children:["Copy/paste the ",(0,i.jsx)(n.code,{children:"oc login ..."})," string from your passwords.txt file to login to your OpenShift from inside the MASCLI container."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"24-lvm-storage",children:"2.4 LVM Storage"}),"\n",(0,i.jsxs)(n.ol,{start:"9",children:["\n",(0,i.jsx)(n.li,{children:"Install LVM operator for OpenShift"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"./install_lvm_storage.sh\n"})}),"\n",(0,i.jsx)(n.h3,{id:"25-registry-lvm",children:"2.5 Registry (LVM)"}),"\n",(0,i.jsxs)(n.ol,{start:"10",children:["\n",(0,i.jsx)(n.li,{children:"Install registry server."}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"./install_lvm_registry.sh\n"})}),"\n",(0,i.jsx)(n.h2,{id:"3-maximo-7x-customization",children:"3 Maximo 7.x customization"}),"\n",(0,i.jsx)(n.h3,{id:"31-instructor-led",children:"3.1 Instructor-led."}),"\n",(0,i.jsx)(n.h2,{id:"4-maximo-7x-database-migration",children:"4 Maximo 7.x database migration"}),"\n",(0,i.jsx)(n.h3,{id:"41-instructor-led",children:"4.1 Instructor-led."}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsx)(n.p,{children:"Your OpenShift must have been installed by now. Jump back up to the Day 2 operations."})}),"\n",(0,i.jsx)(n.h2,{id:"5-maximo-application-suite--manage",children:"5 Maximo Application Suite & Manage"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"./install_mas.sh\n"})})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}}}]);